<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novo Pedido - ATIVA</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <div class="logo-container">
        <img src="/static/logo.png" alt="Logo ATIVA">
    </div>
    
    <h2 style="text-align: center;">üßæ Fazer um Pedido</h2>

    <form method="POST" id="formPedido">
        <div class="card" style="max-width: 600px; margin: 30px auto;">
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <label style="display: block; margin-bottom: 8px; color: #10b981; font-weight: 600;">üë§ Cliente</label>
                    <input type="text" name="cliente" id="cliente" placeholder="Nome do cliente" required>
                </div>
                <div style="flex: 1; min-width: 150px;">
                    <label style="display: block; margin-bottom: 8px; color: #10b981; font-weight: 600;">üìÖ Data</label>
                    <input type="date" name="data" id="data" required>
                </div>
            </div>
        </div>

        <hr>

        <!-- BOT√ÉO FILTRO -->
        <div style="text-align: center; margin: 30px 0;">
            <button type="button" class="btn btn-grande" onclick="toggleFiltro()">
                üìã Selecionar Produtos
            </button>
        </div>

        <!-- FILTRO DE PRODUTOS -->
        <div id="filtro" style="display:none; max-width: 700px; margin: 30px auto;">
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #10b981;">üõí Escolha os produtos:</label>
                <select id="listaProdutos" multiple size="7" style="width: 100%; padding: 12px;">
                    {% for p in produtos|sort %}
                        <option value="{{ p }}">{{ p }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="button" class="btn btn-grande" style="width: 100%;" onclick="adicionarProdutos()">
                ‚úÖ Adicionar Produtos Selecionados
            </button>
            <p style="margin-top: 12px; opacity: 0.7; text-align: center;">
                <small>üí° Segure <strong>CTRL</strong> (ou <strong>CMD</strong>) para selecionar v√°rios produtos</small>
            </p>
        </div>

        <hr>

        <!-- PRODUTOS SELECIONADOS -->
        <div id="produtosSelecionados" style="max-width: 900px; margin: 30px auto;"></div>

        <div style="max-width: 900px; margin: 30px auto; display:flex; gap:10px; flex-wrap: wrap; justify-content: center;">
            <button type="submit" class="btn btn-grande">
                üì• Gerar e Baixar Pedido
            </button>

            <button type="button" class="btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);" onclick="limparPedido()">
                üîÑ Limpar Pedido
            </button>
        </div>
    </form>

    <a class="btn-voltar" href="/">‚Üê Voltar ao Menu</a>
</div>

<script>
function toggleFiltro() {
    const filtro = document.getElementById("filtro");
    filtro.style.display = filtro.style.display === "none" ? "block" : "none";
}

function adicionarProdutos() {
    const select = document.getElementById("listaProdutos");
    const container = document.getElementById("produtosSelecionados");

    Array.from(select.selectedOptions).forEach(option => {
        const produto = option.value;

        // Evita duplicar produto
        if (document.getElementById("produto_" + produto)) return;

        const div = document.createElement("div");
        div.className = "card";
        div.id = "produto_" + produto;

        div.innerHTML = `
            <strong style="font-size: 1.2rem; color: #10b981; display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                <span>üì¶</span> ${produto}
            </strong>
            <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <div>
                    <label style="display: block; margin-bottom: 6px; color: #fbbf24; font-size: 0.9rem;">Quantidade</label>
                    <input type="number" name="qtd_${produto}" placeholder="Ex: 5" required min="1" step="0.01">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; color: #fbbf24; font-size: 0.9rem;">Unidade</label>
                    <select name="unidade_${produto}">
                        {% for u in unidades %}
                            <option value="{{ u }}">{{ u }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; color: #fbbf24; font-size: 0.9rem;">Pre√ßo Unit√°rio (R$)</label>
                    <input type="number" name="preco_${produto}" placeholder="Ex: 10.50" step="0.01">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 6px; color: #fbbf24; font-size: 0.9rem;">Valor Total (R$)</label>
                    <input type="number" name="valor_${produto}" placeholder="Ex: 52.50" step="0.01">
                </div>
            </div>
            <button type="button" class="btn-danger" style="margin-top: 12px; width: 100%;" onclick="removerProduto('${produto}')">
                üóëÔ∏è Remover Produto
            </button>
        `;

        container.appendChild(div);
    });
}

function removerProduto(produto) {
    const div = document.getElementById("produto_" + produto);
    if (div) div.remove();
}

function limparPedido() {
    if (confirm("‚ö†Ô∏è Tem certeza que deseja limpar todos os dados do pedido?")) {
        document.getElementById("cliente").value = "";
        document.getElementById("data").value = "";
        document.getElementById("produtosSelecionados").innerHTML = "";
        
        const select = document.getElementById("listaProdutos");
        Array.from(select.options).forEach(option => option.selected = false);
        
        document.getElementById("filtro").style.display = "none";
    }
}
</script>
</body>
</html>
